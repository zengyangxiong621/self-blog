# å†…å­˜å­˜å‚¨ä½ç½®

æ·±å…¥äº†è§£ JavaScript ä¸­ä¸åŒç±»å‹æ•°æ®çš„å­˜å‚¨ä½ç½®ï¼Œç†è§£æ ˆå†…å­˜å’Œå †å†…å­˜çš„åŒºåˆ«ä¸åº”ç”¨ã€‚

## ğŸ—ï¸ å†…å­˜ç»“æ„æ¦‚è¿°

JavaScript è¿è¡Œæ—¶çš„å†…å­˜ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªåŒºåŸŸï¼š

### æ ˆå†…å­˜ï¼ˆStack Memoryï¼‰
- **å­˜å‚¨å†…å®¹**ï¼šåŸºæœ¬æ•°æ®ç±»å‹çš„å€¼ã€å¼•ç”¨ç±»å‹çš„åœ°å€
- **ç‰¹ç‚¹**ï¼šåè¿›å…ˆå‡ºï¼ˆLIFOï¼‰ã€è®¿é—®é€Ÿåº¦å¿«ã€ç©ºé—´æœ‰é™
- **ç®¡ç†æ–¹å¼**ï¼šè‡ªåŠ¨ç®¡ç†ï¼Œå‡½æ•°æ‰§è¡Œå®Œæ¯•è‡ªåŠ¨æ¸…ç†

### å †å†…å­˜ï¼ˆHeap Memoryï¼‰  
- **å­˜å‚¨å†…å®¹**ï¼šå¼•ç”¨ç±»å‹çš„å®é™…æ•°æ®ï¼ˆå¯¹è±¡ã€æ•°ç»„ã€å‡½æ•°ç­‰ï¼‰
- **ç‰¹ç‚¹**ï¼šç©ºé—´è¾ƒå¤§ã€è®¿é—®é€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢
- **ç®¡ç†æ–¹å¼**ï¼šéœ€è¦åƒåœ¾å›æ”¶æœºåˆ¶æ¸…ç†

## ğŸ“Š æ•°æ®ç±»å‹å­˜å‚¨è¯¦è§£

### åŸºæœ¬ç±»å‹å­˜å‚¨
```javascript
// æ ˆå†…å­˜å­˜å‚¨ç¤ºä¾‹
let a = 10;        // æ ˆï¼ša -> 10
let b = 'hello';   // æ ˆï¼šb -> 'hello'  
let c = true;      // æ ˆï¼šc -> true
let d = null;      // æ ˆï¼šd -> null
let e = undefined; // æ ˆï¼še -> undefined

// å†…å­˜ç¤ºæ„å›¾
/*
æ ˆå†…å­˜ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ a    â”‚    10     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ b    â”‚  'hello'  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ c    â”‚   true    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ d    â”‚   null    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ e    â”‚ undefined â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
*/
```

### å¼•ç”¨ç±»å‹å­˜å‚¨
```javascript
// å †å†…å­˜å­˜å‚¨ç¤ºä¾‹
let obj = { name: 'Alice', age: 25 };
let arr = [1, 2, 3, 4, 5];
let func = function() { return 'hello'; };

// å†…å­˜ç¤ºæ„å›¾
/*
æ ˆå†…å­˜ï¼š                    å †å†…å­˜ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ obj  â”‚ 0x001234 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ { name: 'Alice',    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚   age: 25 }         â”‚
â”‚ arr  â”‚ 0x005678 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â†’â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚ [1, 2, 3, 4, 5]     â”‚
â”‚ func â”‚ 0x009ABC â”‚â”€â”€â”€â”€â”€â”€â”€â”€â†’â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ function() {...}    â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
*/
```

## ğŸ”„ å˜é‡èµ‹å€¼è¿‡ç¨‹

### åŸºæœ¬ç±»å‹èµ‹å€¼
```javascript
let x = 100;
let y = x;  // å¤åˆ¶å€¼åˆ°æ–°çš„æ ˆä½ç½®
y = 200;    // åªä¿®æ”¹ y çš„æ ˆä½ç½®

console.log(x); // 100 (ä¸å—å½±å“)
console.log(y); // 200

// å†…å­˜å˜åŒ–è¿‡ç¨‹
/*
æ­¥éª¤1: let x = 100
æ ˆ: [x: 100]

æ­¥éª¤2: let y = x
æ ˆ: [x: 100, y: 100]  // å¤åˆ¶å€¼

æ­¥éª¤3: y = 200  
æ ˆ: [x: 100, y: 200]  // åªä¿®æ”¹ y
*/
```

### å¼•ç”¨ç±»å‹èµ‹å€¼
```javascript
let obj1 = { value: 100 };
let obj2 = obj1;  // å¤åˆ¶å¼•ç”¨åœ°å€
obj2.value = 200; // é€šè¿‡å¼•ç”¨ä¿®æ”¹å †ä¸­çš„æ•°æ®

console.log(obj1.value); // 200 (è¢«å½±å“)
console.log(obj2.value); // 200

// å†…å­˜å˜åŒ–è¿‡ç¨‹
/*
æ­¥éª¤1: let obj1 = { value: 100 }
æ ˆ: [obj1: 0x001]
å †: [0x001: { value: 100 }]

æ­¥éª¤2: let obj2 = obj1
æ ˆ: [obj1: 0x001, obj2: 0x001]  // å¤åˆ¶åœ°å€
å †: [0x001: { value: 100 }]

æ­¥éª¤3: obj2.value = 200
æ ˆ: [obj1: 0x001, obj2: 0x001]  // åœ°å€ä¸å˜
å †: [0x001: { value: 200 }]     // å †ä¸­æ•°æ®è¢«ä¿®æ”¹
*/
```

## ğŸ¯ å‡½æ•°è°ƒç”¨ä¸å†…å­˜

### å‡½æ•°æ‰§è¡Œæ ˆ
```javascript
function outer() {
  let a = 10;
  
  function inner() {
    let b = 20;
    return a + b;
  }
  
  return inner();
}

let result = outer();

// æ‰§è¡Œæ ˆå˜åŒ–
/*
1. å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡
   æ ˆ: [result: undefined]

2. outer() è°ƒç”¨
   æ ˆ: [result: undefined] 
       [outer: a=10]

3. inner() è°ƒç”¨  
   æ ˆ: [result: undefined]
       [outer: a=10]
       [inner: b=20]

4. inner() è¿”å›
   æ ˆ: [result: undefined]
       [outer: a=10]

5. outer() è¿”å›
   æ ˆ: [result: 30]
*/
```

### é—­åŒ…çš„å†…å­˜å½±å“
```javascript
function createCounter() {
  let count = 0;  // å­˜å‚¨åœ¨å †ä¸­ï¼ˆè¢«é—­åŒ…å¼•ç”¨ï¼‰
  
  return function() {
    count++;
    return count;
  };
}

let counter = createCounter();

// å†…å­˜çŠ¶æ€
/*
æ ˆå†…å­˜ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ counter â”‚ 0x001234 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å †å†…å­˜ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 0x001234: function() {  â”‚
â”‚   // é—­åŒ…ä½œç”¨åŸŸé“¾       â”‚
â”‚   count: 0              â”‚
â”‚   return ++count;       â”‚
â”‚ }                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
*/
```

## âš¡ æ€§èƒ½å½±å“

### æ ˆæ“ä½œæ€§èƒ½
```javascript
// æ ˆæ“ä½œå¾ˆå¿«
function stackOperations() {
  let start = performance.now();
  
  for (let i = 0; i < 1000000; i++) {
    let a = i;
    let b = a * 2;
    let c = b + 1;
  }
  
  let end = performance.now();
  console.log('æ ˆæ“ä½œæ—¶é—´:', end - start, 'ms');
}
```

### å †æ“ä½œæ€§èƒ½
```javascript
// å †æ“ä½œç›¸å¯¹è¾ƒæ…¢
function heapOperations() {
  let start = performance.now();
  
  for (let i = 0; i < 1000000; i++) {
    let obj = { value: i };
    obj.doubled = obj.value * 2;
    obj.incremented = obj.doubled + 1;
  }
  
  let end = performance.now();
  console.log('å †æ“ä½œæ—¶é—´:', end - start, 'ms');
}
```

## ğŸ” å†…å­˜ä½¿ç”¨ç›‘æ§

### ç›‘æ§å†…å­˜ä½¿ç”¨
```javascript
function monitorMemory() {
  if (performance.memory) {
    const memory = performance.memory;
    
    console.log('å·²ä½¿ç”¨å †å†…å­˜:', (memory.usedJSHeapSize / 1024 / 1024).toFixed(2), 'MB');
    console.log('æ€»å †å†…å­˜:', (memory.totalJSHeapSize / 1024 / 1024).toFixed(2), 'MB');
    console.log('å †å†…å­˜é™åˆ¶:', (memory.jsHeapSizeLimit / 1024 / 1024).toFixed(2), 'MB');
  }
}

// å®šæœŸç›‘æ§
setInterval(monitorMemory, 5000);
```

### å†…å­˜æ³„æ¼æ£€æµ‹
```javascript
function detectMemoryLeak() {
  const initialMemory = performance.memory.usedJSHeapSize;
  
  // æ‰§è¡Œå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼çš„æ“ä½œ
  const objects = [];
  for (let i = 0; i < 100000; i++) {
    objects.push({ id: i, data: new Array(1000).fill(i) });
  }
  
  const afterMemory = performance.memory.usedJSHeapSize;
  const increase = (afterMemory - initialMemory) / 1024 / 1024;
  
  console.log('å†…å­˜å¢é•¿:', increase.toFixed(2), 'MB');
  
  // æ¸…ç†å¼•ç”¨
  objects.length = 0;
  
  // å»ºè®®åƒåœ¾å›æ”¶
  if (window.gc) {
    window.gc();
  }
  
  setTimeout(() => {
    const finalMemory = performance.memory.usedJSHeapSize;
    const remaining = (finalMemory - initialMemory) / 1024 / 1024;
    console.log('æ¸…ç†åå‰©ä½™:', remaining.toFixed(2), 'MB');
  }, 1000);
}
```

## ğŸ› ï¸ ä¼˜åŒ–å»ºè®®

### å‡å°‘å †å†…å­˜åˆ†é…
```javascript
// âŒ é¢‘ç¹åˆ›å»ºå¯¹è±¡
function inefficient() {
  const results = [];
  for (let i = 0; i < 10000; i++) {
    results.push({ index: i, value: i * 2 });
  }
  return results;
}

// âœ… é‡ç”¨å¯¹è±¡
function efficient() {
  const results = [];
  const reusableObj = { index: 0, value: 0 };
  
  for (let i = 0; i < 10000; i++) {
    reusableObj.index = i;
    reusableObj.value = i * 2;
    results.push({ ...reusableObj }); // åªåœ¨éœ€è¦æ—¶åˆ›å»ºæ–°å¯¹è±¡
  }
  return results;
}
```

### åŠæ—¶æ¸…ç†å¼•ç”¨
```javascript
// âœ… ä¸»åŠ¨æ¸…ç†å¤§å¯¹è±¡
function processLargeData() {
  let largeArray = new Array(1000000).fill(0);
  
  // å¤„ç†æ•°æ®
  const result = largeArray.reduce((sum, val) => sum + val, 0);
  
  // æ¸…ç†å¼•ç”¨
  largeArray = null;
  
  return result;
}
```

## ğŸ“š æ€»ç»“

### å­˜å‚¨è§„åˆ™
- **åŸºæœ¬ç±»å‹**ï¼šå€¼å­˜å‚¨åœ¨æ ˆå†…å­˜
- **å¼•ç”¨ç±»å‹**ï¼šå¼•ç”¨å­˜å‚¨åœ¨æ ˆå†…å­˜ï¼Œæ•°æ®å­˜å‚¨åœ¨å †å†…å­˜
- **å‡½æ•°å‚æ•°**ï¼šæŒ‰å€¼ä¼ é€’ï¼ˆåŒ…æ‹¬å¼•ç”¨å€¼ï¼‰

### æ€§èƒ½è€ƒè™‘
- **æ ˆæ“ä½œ**ï¼šé€Ÿåº¦å¿«ï¼Œè‡ªåŠ¨ç®¡ç†
- **å †æ“ä½œ**ï¼šé€Ÿåº¦è¾ƒæ…¢ï¼Œéœ€è¦åƒåœ¾å›æ”¶
- **å†…å­˜æ³„æ¼**ï¼šä¸»è¦å‘ç”Ÿåœ¨å †å†…å­˜

### æœ€ä½³å®è·µ
- åˆç†ä½¿ç”¨åŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹
- é¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º
- åŠæ—¶æ¸…ç†ä¸å†ä½¿ç”¨çš„å¼•ç”¨
- ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ

é€šè¿‡ç†è§£å†…å­˜å­˜å‚¨æœºåˆ¶ï¼Œä½ å°†èƒ½å¤Ÿç¼–å†™æ›´é«˜æ•ˆçš„ JavaScript ä»£ç ï¼ğŸš€ 